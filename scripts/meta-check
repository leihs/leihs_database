#!/usr/bin/env bash
set -exu
export LEIHS_DATABASE_NAME=leihs_seeds
dropdb $LEIHS_DATABASE_NAME
createdb $LEIHS_DATABASE_NAME
{ pg_restore --version | grep -q '11.' ;} && psql -d $LEIHS_DATABASE_NAME -c "DROP SCHEMA IF EXISTS \"public\";"
pg_restore --disable-triggers -x -O -d $LEIHS_DATABASE_NAME db/structure_and_seeds.pgbin
if bundle exec rake db:migrate:status | grep -q -E "\s*down\s*\d*\s*"; then
  echo "Run ./scripts/migrate-and-dump-seeds"
  exit 1
else
  exit 0
fi
